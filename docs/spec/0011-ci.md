# Molt CI Plan (GitHub Actions)

## 1. Pipeline Overview
Molt uses a unified GitHub Actions pipeline for both the Python compiler and the Rust runtime.

## 2. Jobs

### 2.1 Python (Compiler & Tooling)
- **Environment**: `ubuntu-latest`.
- **Steps**:
    - Install `uv`.
    - `uv python install <version>`.
    - `uv sync --frozen --python <version>`.
    - `uv run ruff check .` (Linting).
  - `uv run ty check src` (Static typing).
    - `uv run pytest` (Python tests in `tests/`).

### 2.2 Rust (Runtime & Core)
- **Environment**: `ubuntu-latest`.
- **Steps**:
    - Install Rust toolchain with `clippy` and `rustfmt`.
    - `cargo fmt --check`.
    - `cargo clippy -- -D warnings`.
    - `cargo test`.

### 2.3 Integration & Differential
- Build the Molt runtime (release).
- Run curated `molt-diff` parity cases against CPython 3.12 (`tests/differential/basic/`).

### 2.4 WASM Parity
- Dedicated job to run `tests/test_wasm_if_else.py` with Node + Rust toolchain.

### 2.5 Performance & Artifacts (planned)
- Run `tools/bench.py` for regression checks.
- Upload benchmark results as PR artifacts or comments.
- Build and upload release binaries for macOS (arm64) and Linux (x86_64, arm64).

## 3. Caching Strategy (recommended)
- **Python**: Cache `~/.cache/uv`.
- **Rust**: Cache `target/` and `~/.cargo/registry` using `swatinem/rust-cache`.
- **WASM**: Cache pre-compiled Molt Packages when WASM packages land.

## 4. Release Trigger
- Tagging a version (`vX.Y.Z`) triggers a full release build with signed binaries and SBOM generation.
